<div class="container my-3">
  <h1><%= @date.strftime('%B %d, %Y') %></h1>

  <% if @happy_things.any? %>
    <div class="row">
      <% @happy_things.group_by(&:user).each do |user, happy_things| %>
        <div class="col-12 mb-4">
          <div class="card p-4 shadow-sm" style="border-radius: 0.5rem; border: 1px solid #e9ecef;">
            <h2 class="mb-3"><%= user.emoji %> <%= user.first_name %></h2>
            <ol class="ps-3">
              <% happy_things.each do |happy_thing| %>
                <li class="mb-4">
                  <strong><%= link_to happy_thing.title.sub(/\S/, &:upcase), happy_thing_path(happy_thing), style: "text-decoration: none; color: inherit;" %></strong>
                  <%= cl_image_tag happy_thing.photo.key, class: "rounded mt-3", height: 200, width: 200, crop: :fill, gravity: :auto if happy_thing.photo.attached? %>

                <!-- Comments Section -->
                <% if happy_thing.comments.any? %>
                  <div class="mt-3">
                    <h5>Comments:</h5>
                    <% happy_thing.comments.each do |comment| %>
                      <div class="comment mb-2">
                        <p class="mb-0"><strong><%= comment.user.first_name %>:</strong> <%= comment.content %></p>
                      </div>
                    <% end %>
                  </div>
                <% end %>
                <!-- End of Comments Section -->
              </li>
            <% end %>
          </ol>
        </div>
      </div>
      <% end %>
    </div>
  <% else %>
    <p class="opacity-50">No Happy Things found for this date.</p>
  <% end %>

  <!-- Conditional Form to add a new Happy Thing, shown only if there are less than 10 happy things -->
  <% if @happy_things.count < 10 %>
    <div class="my-5">
      <h3>Forgot something? Add more Happy Things</h3>
      <%= simple_form_for(@old_happy_thing, url: happy_things_old_happy_thing_path, method: :post, html: { multipart: true }) do |f| %>
        <%= f.input :title, label: 'Title', required: true, input_html: {class: 'form-control mt-3 mb-2'} %>
        <%= f.hidden_field :start_time, value: @date.strftime('%Y-%m-%d %H:%M:%S') %>
        <%= f.input :photo, as: :file, label: 'Upload Photo (optional)', input_html: {class: 'form-control-file mt-3'} %>
        <%= f.button :submit, 'Save', class: 'btn button--primary mt-3' %>
      <% end %>
    </div>
  <% end %>

  <%= link_to 'Back to Dashboard', root_path, class: "btn button--primary" %>
</div>
